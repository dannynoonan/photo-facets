{% extends 'manage.html' %}

{% block body %}

{% if media_item %}
<p></p>
{% if prev_media_item_id %}
    <a href="/lockdownsf/manage/mediaitem_view/{{ prev_media_item_id }}/" class="navigate">&#8249;</a>
{% endif %}
<img src="{{ media_item.thumb_url }}"/>
{% if next_media_item_id %}
    <a href="/lockdownsf/manage/mediaitem_view/{{ next_media_item_id }}/" class="navigate">&#8250;</a>
{% endif %}

<!-- <div id="miniGmap"></div> -->
<p></p>

<h4>Editable fields:</h4>
<form action="/lockdownsf/manage/mediaitem_edit/" method="POST">
    {% csrf_token %}
    <input type="hidden" name="media-item-external-id" value="{{ media_item.external_id }}">
    <input type="hidden" id="update-description-flag" name="update-description-flag" value="">
    <input type="hidden" id="update-tags-flag" name="update-tags-flag" value="">
    <table class="table table-hover table-fit">
        <tr><th scope="row">Description:</th>
            <td id="description-display-cell">
                <div id="description-display" onclick="makeDescriptionEditable()">
                {% if media_item.description %}
                    {{ media_item.description }}
                {% else %}
                    [+]
                {% endif %}
                </div></td>
            <td id="description-input-cell" class="hidden-block">
                <input type="text" id="description-input" class="form-control" name="description" value="{{ media_item.description }}">
            </td>
        </tr>
        <tr><th scope="row">Tags:</th>
            <td id="tag-display-cell">
                <div id="tag-display" onclick="makeTagsEditable()">
                {% if media_item.tags.all %}
                    <ul>
                    {% for tag in media_item.tags.all %}
                        <li {% if tag.status == 'DISABLED' %} class="text-muted" {% endif %}>{{ tag.name }}</li>
                    {% endfor %}
                    </ul>
                {% else %}
                    [+]
                {% endif %}
                </div></td>
            <td id="tag-checkbox-cell" class="hidden-block">
                {% for tag in all_tags %}
                <div class="form-group custom-control custom-checkbox">
                    <input type="checkbox" id="tag-{{ tag.id }}" class="custom-control-input" name="tag-ids" value="{{ tag.id }}"
                    {% if tag in media_item.tags.all %} checked="" {% endif %}>
                    <label class="custom-control-label {% if tag.status == 'DISABLED' %} text-muted {% endif %}" 
                        for="tag-{{ tag.id }}">{{ tag.name }}</label>
                </div>
                {% endfor %} 
            </td>
        </tr>
        <tr><td id="submit-cell" class="hidden-block" colspan="2">
            <input id="submit-buttom" type="submit" value="Update" class="btn btn-secondary"></td></tr>
    </table>
</form>

<h4>Automagic fields:</h4>
<table class="table table-hover table-fit">
    <tbody>
        <tr><th scope="row">Google photos id:</th>
            <td><a href="https://photos.google.com/lr/album/{{ media_item.album.external_id }}/photo/{{ media_item.external_id }}" target="new">
                    {{ media_item.external_id }}</a></td></tr>
        <tr><th scope="row">File name:</th>
            <td>{{ media_item.file_name }}</td></tr>
        <tr><th scope="row">Album:</th>
            <!-- <td><a href="https://photos.google.com/lr/album/{{ media_item.album.external_id }}" target="new"> -->
            <td><a href="/lockdownsf/manage/album_view/{{ media_item.album.external_id }}/">
                    {{ media_item.album.name }}</a></td></tr>
        <tr><th scope="row">Date taken:</th>
            <td>{{ media_item.dt_taken }}</td></tr>
        <tr><th scope="row">Date added:</th>
            <td>{{ media_item.dt_inserted }}</td></tr>
        <tr><th scope="row">Date updated:</th>
            <td>{{ media_item.dt_updated }}</td></tr>
        <tr><th scope="row">File format:</th>
            <td>{{ media_item.mime_type }}</td></tr>
        <tr><th scope="row">Latitude:</th>
            <td>{{ media_item.latitude }}</td></tr>
        <tr><th scope="row">Longitude:</th>
            <td>{{ media_item.longitude }}</td></tr>
        <tr><th scope="row">Dimensions:</th>
            <td>{{ media_item.width }} x {{ media_item.height }}</td></tr>
        <tr><th scope="row">Status:</th>
            <td>{{ media_item.status }}</td></tr>
        <tr><th scope="row">Extracted text:</th>
            <form action="/lockdownsf/manage/extract_ocr_text/" method="POST">
                {% csrf_token %}
                <input type="hidden" name="request-scope" value="media_item">
                <input type="hidden" name="external-id" value="{{ media_item.external_id }}">
                <td>
                    {% if media_item.extracted_text_display %}
                    <small>{{ media_item.extracted_text_display|linebreaks }}</small>
                    <input type="submit" value="Regenerate OCR text" class="btn btn-secondary">
                    {% else %}
                    <input type="submit" value="Extract OCR text" class="btn btn-secondary">
                    {% endif %}
                </td>
            </form>
        </tr>
    </tbody>
</table>


{% else %}
<div class="alert alert-warning">
    <h5>No media item found matching external_id <strong>{{ media_item_external_id }}</strong></h5>
</div>
{% endif %}

{% if exception %}
<div class="alert alert-danger">
    <h5><strong>Exception:</strong> {{ exception }}</h5>
    <p>Data dump: {{ dump }}</p>
</div>
{% endif %}

{% endblock %}